{% extends 'layout.twig' %}

{% block content %}
  <h3>New Field</h3>
  {% if error %}
  <div class="alert alert-danger" role="alert">
    Issue when we save the field : {{ error }}
  </div>
  {% endif %}
  <form id="fieldForm" action="/field/save" method="POST">
    <input type="hidden" id="objectId" name="objectId" value="{{ objectId }}">
    <div class="form-group">
      <label for="fieldLabel">Label</label>
      <input type="text" class="form-control" id="fieldLabel" name="fieldLabel" aria-describedby="labelHelp" placeholder="Enter field label">
      <small id="labelHelp" class="form-text text-muted">Define a label for your field</small>
    </div>
    <div class="form-group">
      <label for="fieldName">Name</label>
      <input type="text" class="form-control" id="fieldName" name="fieldName" aria-describedby="nameHelp" placeholder="Enter field name">
      <small id="nameHelp" class="form-text text-muted">Define a name for your field. Name could not include space or special character.</small>
    </div>
    <div class="form-group">
      <label for="fieldDescription">Description</label>
      <small id="descHelp" class="form-text text-muted">Description of the field</small>
      <textarea class="form-control" aria-describedby="descHelp" id="fieldDescription" name="fieldDescription" rows="2"></textarea>
    </div>
    <div class="form-group">
      <label for="fieldHelper">Helper</label>
      <small id="helperHelp" class="form-text text-muted">Helper for the field</small>
      <textarea class="form-control" aria-describedby="helperHelp" id="fieldHelper" name="fieldHelper" rows="2"></textarea>
    </div>
    <div class="form-group form-check">
      <input type="checkbox" class="form-check-input" id="fieldRequired" name="fieldRequired">
      <label class="form-check-label" for="fieldRequired">Field always required</label>
    </div>
    <div class="form-group">
      <label for="fieldDefault">Default</label>
      <input type="text" class="form-control" id="fieldDefault" name="fieldDefault" aria-describedby="defaultHelp" placeholder="Enter default value">
      <small id="defaultHelp" class="form-text text-muted">Default value for the field.</small>
    </div>

    <fieldset class="form-group">
      <div class="row">
        <legend class="col-form-label col-sm-2 pt-0">Type</legend>
        <div class="col-sm-10">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="fieldType" id="fieldTypeId" value="autoGenerated">
            <label class="form-check-label" for="fieldTypeId">
              Id (auto-generation)
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="fieldType" id="fieldTypeCheckbox" value="checkbox">
            <label class="form-check-label" for="fieldTypeCheckbox">
              Checkbox
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="fieldType" id="fieldTypeCurrency" value="currency">
            <label class="form-check-label" for="fieldTypeCurrency">
              Currency
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="fieldType" id="fieldTypeDate" value="date">
            <label class="form-check-label" for="fieldTypeDate">
              Date
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="fieldType" id="fieldTypeNumber" value="number">
            <label class="form-check-label" for="fieldTypeNumber">
              Number
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="fieldType" id="fieldTypeObject" value="object">
            <label class="form-check-label" for="fieldTypeObject">
              Object
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="fieldType" id="fieldTypePhone" value="phone">
            <label class="form-check-label" for="fieldTypePhone">
              Phone
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="fieldType" id="fieldTypePicklist" value="picklist">
            <label class="form-check-label" for="fieldTypePicklist">
              Picklist
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="fieldType" id="fieldTypePicklistMulti" value="picklistMulti">
            <label class="form-check-label" for="fieldTypePicklistMulti">
              Picklist Multi Select
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="fieldType" id="fieldTypeText" value="text">
            <label class="form-check-label" for="fieldTypeText">
              Text
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="fieldType" id="fieldTypeTextArea" value="textArea">
            <label class="form-check-label" for="fieldTypeTextArea">
              Text Area
            </label>
          </div>
        </div>
      </div>
    </fieldset>

    <div id="lengthExtraField" class="form-group extraFields d-none">
      <label for="fieldLength" class="col-sm-2 col-form-label">Length</label>
      <div class="col-sm-10">
        <input type="number" class="form-control" id="fieldLength" name="fieldLength">
      </div>
    </div>
    <div id="decimalExtraField" class="form-group extraFields d-none">
      <label for="fieldDecimal" class="col-sm-2 col-form-label">Decimal</label>
      <div class="col-sm-10">
        <input type="number" class="form-control" id="fieldDecimal" name="fieldDecimal">
      </div>
    </div>
    <div id="uniqueExtraField" class="form-group extraFields d-none">
      <div class="form-group form-check">
        <input type="checkbox" class="form-check-input" id="fieldUnique" name="fieldUnique">
        <label class="form-check-label" for="fieldUnique">Field needs to be unique</label>
      </div>
    </div>
    <div id="listOrValuesExtraField" class="form-group extraFields d-none">
      <fieldset class="form-group">
        <div class="row">
          <legend class="col-form-label col-sm-2 pt-0">List or Values</legend>
          <div class="col-sm-10">
            <div class="form-check">
              <input class="form-check-input" type="radio" id="fieldListOrValuesListCheckbox" name="fieldListOrValuesCheckbox" value="list" checked>
              <label class="form-check-label" for="fieldListOrValuesListCheckbox">
                List
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" id="fieldListOrValuesListCheckbox" name="fieldListOrValuesCheckbox" value="values">
              <label class="form-check-label" for="fieldListOrValuesListCheckbox">
                Values
              </label>
            </div>
        </div>
      </fieldset>
      <div id="fieldListOrValuesList" class="form-group">
        <select class="form-control" id="fieldListId" name="fieldListId">
          <option></option>
          {% for list in lists %}
            <option value="{{ list.id }}">{{ list.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div id="fieldListOrValuesValues" class="form-group d-none">
        <label for="fieldValuesList">Values for the list</label>
        <small id="valuesHelp" class="form-text text-muted">Input one value by line</small>
        <textarea class="form-control" aria-describedby="valuesHelp" id="fieldValuesList" name="fieldValuesList" rows="5"></textarea>
      </div>
    </div>
    <div id="objectExtraField" class="form-group extraFields d-none">
      <select class="form-control" id="fieldObjectId" name="fieldObjectId">
        <option></option>
        {% for object in objects if object.id != objectId %}
          <option value="{{ object.id }}">{{ object.label }}</option>
        {% endfor %}
      </select>
    </div>
    <div id="displayLineExtraField" class="form-group extraFields d-none">
      <label for="fieldDisplayLine" class="col-sm-2 col-form-label">Displayed Line</label>
      <div class="col-sm-10">
        <input type="number" class="form-control" id="fieldDisplayLine" name="fieldDisplayLine" value="3">
      </div>
    </div>

    <button type="submit" class="btn btn-primary">Save</button>
  </form>

{% endblock %}

{% block script %}
  {{ parent() }}
  <script src="/javascripts/jquery-ui.min.js"></script>
  <script>
    jQuery(function($) {
      $('input[type=radio][name=fieldType]').change(function() {
        const extraFields = {
          currency: ['length', 'decimal'],
          number: ['length', 'decimal'],
          text: ['unique'],
          picklist: ['listOrValues'],
          picklistMulti: ['listOrValues', 'displayLine'],
          object: ['object']
        }
        const selectedField = this.value
        $('div.extraFields').each(function () {
          $(this).addClass('d-none')
        })
        $.each(extraFields, function(key, value) {
          if (key === selectedField) {
            $.each(value, function (index, value) {
              const selector = '#' + value + 'ExtraField'
              $(selector).removeClass('d-none')
            })
          }
        })
      })
      $('input[type=radio][name=fieldListOrValuesCheckbox]').change(function() {
        if (this.value === 'list') {
          $('#fieldListOrValuesValues').addClass('d-none')
          $('#fieldListOrValuesList').removeClass('d-none')
        } else if (this.value === 'values') {
          $('#fieldListOrValuesList').addClass('d-none')
          $('#fieldListOrValuesValues').removeClass('d-none')
        }
      })
    })
  </script>
{% endblock %}
